
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MMSU Stallion AI Companion</title>
    
    <!-- Scripts for No-Build React & AI -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.2.3",
    "react-dom": "https://esm.sh/react-dom@19.2.3",
    "react-dom/client": "https://esm.sh/react-dom@19.2.3/client",
    "@google/genai": "https://esm.sh/@google/genai@1.37.0",
    "react/": "https://esm.sh/react@^19.2.4/"
  }
}
</script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        mmsu: {
                            green: '#014421',
                            gold: '#FFD700',
                            darkGreen: '#003318',
                            lightGold: '#FFF2B2'
                        }
                    },
                    animation: {
                        fadeIn: 'fadeIn 0.5s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }
        body { -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 transition-colors duration-300 dark:bg-gray-900 dark:text-white">
    <div id="root"></div>

    <!-- This script contains the entire Application logic -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import ReactDOM from 'react-dom/client';
        import { GoogleGenAI } from "@google/genai";

        // --- DOMAIN DATA & TYPES ---
        const COLLEGES = [
            'College of Agriculture, Food and Sustainable Development',
            'College of Aquatic Science and Applied Technology',
            'College of Arts and Sciences',
            'College of Business, Economics and Accountancy',
            'College of Computing and Information Sciences',
            'College of Engineering',
            'College of Health Sciences',
            'College of Industrial Technology',
            'College of Teacher Education',
            'College of Medicine',
            'College of Law',
            'College of Dentistry',
            'College of Veterinary Medicine',
            'Graduate School'
        ];

        const MOCK_COURSES = [
            { id: 'c9', code: 'IT 101', title: 'Introduction to Computing', college: 'College of Computing and Information Sciences', description: 'Fundamental concepts of computer hardware and software.', credits: 3 },
            { id: 'c10', code: 'CMPSC 146', title: 'Software Engineering', college: 'College of Computing and Information Sciences', description: 'Systematic approach to software development.', credits: 3 },
            { id: 'c12', code: 'CE 201', title: 'Statics of Rigid Bodies', college: 'College of Engineering', description: 'Analysis of force systems in equilibrium.', credits: 3 },
            { id: 'c5', code: 'BIO 101', title: 'General Biology', college: 'College of Arts and Sciences', description: 'Study of life and living organisms.', credits: 4 }
        ];

        const MOCK_ANNOUNCEMENTS = [
            { id: 'a1', title: '2nd Sem Enrollment AY 2025-2026', date: 'Jan 12, 2026', content: 'Enrollment is now active for all year levels.', category: 'Enrollment' },
            { id: 'a2', title: 'Stallion Scholarship Renewal', date: 'Jan 18, 2026', content: 'Submit documents at the Student Affairs office.', category: 'Scholarship' },
            { id: 'a3', title: 'MMSU 48th Foundation Anniversary', date: 'Jan 20, 2026', content: 'Celebration at the Sunken Garden today!', category: 'Event' }
        ];

        // --- APPLICATION LAYER: CHAT ORCHESTRATOR ---
        async function getAIResponse(prompt, college, mode, studentId, history) {
            try {
                const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
                const systemInstruction = `
                You are the "MMSU Stallion AI Companion." 
                Context: MMSU Batac Main Campus, 2nd Semester 2025-2026. 
                Today is Foundation Day (Jan 20).
                User: ${college} Student (ID: ${studentId || 'Guest'}).
                ${mode === 'TUTORING' ? 'Mode: Academic Tutoring. Be educational and explain concepts.' : 'Mode: General Assistant.'}`;

                const contents = history.map(msg => ({
                    role: msg.role === 'user' ? 'user' : 'model',
                    parts: [{ text: msg.content }]
                }));
                contents.push({ role: 'user', parts: [{ text: prompt }] });

                const response = await ai.models.generateContent({
                    model: "gemini-3-flash-preview",
                    contents,
                    config: { systemInstruction, tools: [{ googleSearch: {} }] },
                });

                const text = response.text || "I'm having trouble connecting to the university server.";
                const links = (response.candidates?.[0]?.groundingMetadata?.groundingChunks || [])
                    .filter(c => c.web).map(c => ({ title: c.web.title, uri: c.web.uri }));

                return { text, links };
            } catch (err) {
                return { text: "Error: " + err.message };
            }
        }

        // --- PRESENTATION LAYER: COMPONENTS ---

        const QuickActions = ({ onAction, mode }) => {
            const actions = mode === 'TUTORING' 
                ? [{ label: 'Study Tips', prompt: 'Provide tips for my major.' }, { label: 'Thesis', prompt: 'MMSU thesis guidelines?' }]
                : [{ label: 'Enrollment', prompt: 'When is enrollment?' }, { label: 'News', prompt: 'Latest MMSU news?' }];
            return (
                <div className="flex flex-wrap gap-2 py-2">
                    {actions.map((a, i) => (
                        <button key={i} onClick={() => onAction(a.prompt)} className="bg-white dark:bg-gray-800 border dark:border-gray-700 px-4 py-2 rounded-full text-[10px] font-black uppercase hover:bg-mmsu-gold transition-all">
                            {a.label}
                        </button>
                    ))}
                </div>
            );
        };

        const Home = ({ user, onChat }) => (
            <div className="space-y-8 animate-fadeIn">
                <section className="bg-mmsu-green text-white p-8 md:p-12 rounded-[2.5rem] shadow-xl relative overflow-hidden">
                    <div className="relative z-10 space-y-4">
                        <span className="bg-mmsu-gold/20 text-mmsu-gold px-4 py-1 rounded-full text-[10px] font-black">AY 2025-2026</span>
                        <h2 className="text-4xl md:text-6xl font-black">Welcome, <span className="text-mmsu-gold">{user.studentId || 'Stallion'}!</span></h2>
                        <p className="opacity-80 text-sm">{user.college} â€¢ {user.campus} Campus</p>
                        <button onClick={onChat} className="bg-mmsu-gold text-mmsu-green px-8 py-3 rounded-2xl font-black uppercase text-xs">Start AI Session</button>
                    </div>
                </div>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {MOCK_ANNOUNCEMENTS.map(a => (
                        <div key={a.id} className="bg-white dark:bg-gray-800 p-6 rounded-3xl border border-gray-100 dark:border-gray-700">
                            <span className="text-[10px] font-black text-mmsu-green uppercase">{a.category}</span>
                            <h4 className="font-bold my-2">{a.title}</h4>
                            <p className="text-xs text-gray-500">{a.content}</p>
                        </div>
                    ))}
                </div>
            </div>
        );

        // --- APPLICATION LAYER: APP CONTROLLER ---
        const App = () => {
            const [user, setUser] = useState(() => {
                const saved = localStorage.getItem('stallion_pref');
                return saved ? JSON.parse(saved) : { college: COLLEGES[4], campus: 'Batac', theme: 'light', studentId: '' };
            });
            const [activeTab, setActiveTab] = useState('home');
            const [chatMode, setChatMode] = useState('GENERAL');
            const [messages, setMessages] = useState([]);
            const [input, setInput] = useState('');
            const [isTyping, setIsTyping] = useState(false);
            const [showIdModal, setShowIdModal] = useState(false);

            useEffect(() => {
                localStorage.setItem('stallion_pref', JSON.stringify(user));
                document.documentElement.classList.toggle('dark', user.theme === 'dark');
            }, [user]);

            const handleSend = async (val) => {
                const text = val || input;
                if (!text.trim()) return;
                const newMsgs = [...messages, { role: 'user', content: text, id: Date.now().toString() }];
                setMessages(newMsgs);
                setInput('');
                setIsTyping(true);
                const res = await getAIResponse(text, user.college, chatMode, user.studentId, newMsgs);
                setMessages(prev => [...prev, { role: 'assistant', content: res.text, links: res.links, id: Date.now()+1 }]);
                setIsTyping(false);
            };

            const toggleTutorMode = () => {
                if (!user.studentId && chatMode === 'GENERAL') {
                    setShowIdModal(true);
                } else {
                    setChatMode(chatMode === 'GENERAL' ? 'TUTORING' : 'GENERAL');
                }
            };

            return (
                <div className="min-h-screen flex flex-col transition-all">
                    <header className="bg-mmsu-green text-white p-4 sticky top-0 z-50 flex justify-between items-center shadow-md">
                        <div className="flex items-center space-x-2">
                            <i className="fas fa-horse-head text-mmsu-gold text-2xl"></i>
                            <h1 className="font-black text-lg">STALLION AI</h1>
                        </div>
                        <div className="flex items-center space-x-4">
                            <button onClick={() => setUser({...user, theme: user.theme === 'light' ? 'dark' : 'light'})}>
                                <i className={`fas fa-${user.theme === 'light' ? 'moon' : 'sun'}`}></i>
                            </button>
                            <div className="w-8 h-8 bg-mmsu-gold rounded-full flex items-center justify-center text-mmsu-green">
                                <i className="fas fa-user text-xs"></i>
                            </div>
                        </div>
                    </header>

                    <main className="flex-1 max-w-6xl mx-auto w-full p-4 md:p-8 mb-20 md:mb-0">
                        {activeTab === 'home' && <Home user={user} onChat={() => setActiveTab('chat')} />}
                        
                        {activeTab === 'chat' && (
                            <div className="h-[75vh] flex flex-col bg-white dark:bg-gray-800 rounded-[2rem] shadow-2xl overflow-hidden border dark:border-gray-700 animate-fadeIn">
                                <div className={`p-4 flex justify-between items-center ${chatMode === 'TUTORING' ? 'bg-mmsu-gold text-mmsu-green' : 'bg-mmsu-green text-white'}`}>
                                    <span className="font-black text-xs uppercase tracking-widest">{chatMode} MODE</span>
                                    <button onClick={toggleTutorMode} className="text-[10px] font-black border border-current px-3 py-1 rounded-lg">SWITCH MODE</button>
                                </div>
                                <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50 dark:bg-gray-900/20">
                                    {messages.length === 0 && <p className="text-center text-xs text-gray-400 mt-10">Stallion AI is ready to assist you.</p>}
                                    {messages.map(m => (
                                        <div key={m.id} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                            <div className={`p-4 rounded-2xl max-w-[85%] text-sm ${m.role === 'user' ? 'bg-mmsu-green text-white' : 'bg-white dark:bg-gray-800 border dark:border-gray-700'}`}>
                                                {m.content}
                                                {m.links && (
                                                    <div className="mt-2 border-t pt-2 flex gap-2 overflow-x-auto">
                                                        {m.links.map((l, i) => <a key={i} href={l.uri} target="_blank" className="text-[9px] bg-blue-50 text-blue-600 px-2 py-1 rounded">{l.title}</a>)}
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    ))}
                                    {isTyping && <div className="text-[10px] font-bold animate-pulse text-mmsu-green">Stallion is thinking...</div>}
                                </div>
                                <div className="p-4 border-t dark:border-gray-700">
                                    <QuickActions onAction={handleSend} mode={chatMode} />
                                    <div className="flex space-x-2 mt-2">
                                        <input type="text" value={input} onChange={(e) => setInput(e.target.value)} onKeyDown={e => e.key === 'Enter' && handleSend()} className="flex-1 bg-gray-100 dark:bg-gray-900 p-3 rounded-xl border-none text-sm outline-none" placeholder="Ask anything Stallion..." />
                                        <button onClick={() => handleSend()} className="bg-mmsu-green text-white p-3 rounded-xl"><i className="fas fa-paper-plane"></i></button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'courses' && (
                            <div className="animate-fadeIn space-y-6">
                                <h3 className="text-2xl font-black">Course Explorer</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {MOCK_COURSES.map(c => (
                                        <div key={c.id} className="p-6 bg-white dark:bg-gray-800 rounded-3xl border dark:border-gray-700">
                                            <span className="text-[10px] font-black bg-mmsu-gold/10 text-mmsu-green p-1 rounded">{c.code}</span>
                                            <h4 className="font-bold mt-2">{c.title}</h4>
                                            <p className="text-xs text-gray-500 mt-2">{c.description}</p>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'tutors' && (
                            <div className="flex flex-col items-center justify-center py-20 text-center space-y-4 animate-fadeIn">
                                <i className="fas fa-user-graduate text-6xl text-mmsu-gold"></i>
                                <h2 className="text-3xl font-black">Join the Tutor Network</h2>
                                <p className="text-gray-500 max-w-sm">Specialized academic support grounded in your specific college's curriculum.</p>
                                <button onClick={() => { setChatMode('TUTORING'); setActiveTab('chat'); }} className="bg-mmsu-green text-white px-10 py-4 rounded-2xl font-black uppercase text-xs">Access AI Tutoring</button>
                            </div>
                        )}
                    </main>

                    <nav className="fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t dark:border-gray-700 flex justify-around p-3 md:relative md:bg-transparent md:border-none md:justify-center md:space-x-12">
                        {['home', 'chat', 'courses', 'tutors'].map(t => (
                            <button key={t} onClick={() => setActiveTab(t)} className={`flex flex-col items-center space-y-1 ${activeTab === t ? 'text-mmsu-green font-bold' : 'text-gray-400'}`}>
                                <i className={`fas fa-${t === 'chat' ? 'comments' : t === 'home' ? 'home' : t === 'courses' ? 'book' : 'user-graduate'} text-xl`}></i>
                                <span className="text-[8px] uppercase font-black">{t}</span>
                            </button>
                        ))}
                    </nav>

                    {showIdModal && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[100] p-4">
                            <div className="bg-white dark:bg-gray-800 p-8 rounded-[2rem] w-full max-w-md shadow-2xl">
                                <h3 className="text-xl font-black mb-4">Stallion ID Verification</h3>
                                <p className="text-xs text-gray-500 mb-6">Enter your student ID (YY-XXXXXX) to access tutoring features.</p>
                                <input type="text" placeholder="21-123456" className="w-full p-4 rounded-xl bg-gray-50 dark:bg-gray-900 border-none mb-6 font-bold text-center tracking-widest" onChange={e => setUser({...user, studentId: e.target.value})} />
                                <div className="flex space-x-3">
                                    <button onClick={() => setShowIdModal(false)} className="flex-1 bg-gray-100 dark:bg-gray-700 py-3 rounded-xl font-black text-xs">CANCEL</button>
                                    <button onClick={() => { setChatMode('TUTORING'); setShowIdModal(false); }} className="flex-1 bg-mmsu-green text-white py-3 rounded-xl font-black text-xs">VERIFY</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
